<!DOCTYPE html>
<html>
<head>
<title>Homework4</title>
<!--
<BODY>
This is for USC disclaimer
</BODY>
-->

<script type="text/javascript">
var html_text="";
var listing_flag=true;
var xmlDoc;
function viewxml(yo)
	{
		
		//var regex =/^http/;
		var url=yo.URL.value;
		//if(yomachi.match(regex)
		//url="http://scf.usc.edu/~channaba/"+yomachi;
				function loadXML(url)
				{	
					if (window.XMLHttpRequest)
  					{// code for IE7+, Firefox, Chrome, Opera, Safari
  					xmlhttp=new XMLHttpRequest();
  					}
					else
  					{// code for IE6, IE5
  					xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
  					}
					xmlhttp.open("GET",url,false);
					xmlhttp.send();
					xmlDoc=xmlhttp.responseXML;
					if(!xmlDoc)
					{
					alert("XML not found!!!");
					}
					return xmlDoc;
				}
		xmlDoc = loadXML(url);
		if(window.ActiveXobject) //IF IE
		{ 
		if(xmlDoc.parseError.errorCode !=0)
		{
	 		var Err=xmlDoc.parseError;
			generateError(xmlDoc);
			alert("error in XML!!");
		}
		else
		{
			genHTML(xmlDoc);
			Win= window.open("", "hw4", "height=800,width=600,scrollbars=yes,toolbar=yes");
			Win.document.write(html_text);
		}
		}	
		else //other browsers
		{
			if (xmlDoc.documentElement.nodeName=="parsererror")
			{
			alert("error in XML!!");
			}
			else
			{
				var listingscheck=xmlDoc.getElementsByTagName("Workbook")[0].childNodes;
				if(listingscheck.length==0)
       				 {
        		 	  alert("There are no lisitings in the  xml");
				  listing_flag=false;
		                 }
				if(listing_flag==true)
				{
				html_text="";
				xmlDoc.onload=genHTML(xmlDoc);
				Win=window.open(" ","hw4","height=800,width=600 ,scrollbars=yes,toolbar=yes");
				Win.document.write(html_text);
				}
			}
		}
Win.document.close();
}
function genHTML(xmlDoc)
{
ELEMENT_NODE =1; 
root=xmlDoc.DocumentElement;
var listings=xmlDoc.getElementsByTagName("Workbook")[0].childNodes;                         //Listings    -- > Workbook
    //gets the number of childnodes from the first Listings element.
html_text+="<html><title>real estate listings</title><h2>Real Estate Listings </h2>";
html_text +="<table border='2'>";
        for(i=0;i<listings.length;i++)
        {
            //item method returns the node at the specified index in the node list  i.e item = Listing
          if(listings.item(i).nodeType==ELEMENT_NODE)                        //checking for Listing element node    --> Table
            {
             html_text +="<tr><th colspan='7'>Listing</th></tr>";
            
              var listingschild=listings.item(i).childNodes;
                //gets the number of childnodes for first listing element. i.e  Location and Listing details
              for(j=0;j<listingschild.length;j++)
               {
                   //item = Location
                 if(listingschild.item(j).nodeType==ELEMENT_NODE)                    //checking for Location element node -->Header
                   {
                      if(listingschild.item(j).nodeName=="Header")            //check for header here
                        {
                          html_text +="<tr>";
                          var listinglocationchild=listingschild.item(j).childNodes;            // gets the childnodes of Location
                             for(k=0;k<listinglocationchild.length;k++)
                             {
                               if(listinglocationchild.item(k).nodeType==ELEMENT_NODE) 
                                   //checks for all street,city,state,zip and all       => checks for Data,data,data,data
                                {
				                    if(listinglocationchild.item(k).hasChildNodes())
            //hasChildNodes() returns true if the current element node has child nodes , else returns false
                                   {
                                    if(listinglocationchild.item(k).firstChild.nodeValue!=" ")
                                     {
                                       html_text +="<td>"+ listinglocationchild.item(k).firstChild.nodeValue+"</td>";
                                     }
                                    else
                                      {
                                        html_text +="<td>&nbsp;</td>";
                                      }
                                   }
                                  else
			                     {
                                    html_text +="<td>&nbsp;</td>";
                                 }
                                  
                                }
                             }
                           html_text +="</tr>";
                        }
                      if(listingschild.item(j).nodeName=="Row")          //checking for Listing details ---> for us Row
                        {
                           html_text +="<tr>";
                          
                            //get the childnodes of Listing details
                            var listingdetailschild=listingschild.item(j).childNodes; 
                             for(k=0;k<listingdetailschild.length;k++)
                             {
                               if(listingdetailschild.item(k).nodeType==ELEMENT_NODE)
                                   //checks for status,price and all for element node
                                {
                                  var nodeName=listingdetailschild.item(k).nodeName;
                                  if(nodeName=="Network" || nodeName=="Owner")
                                   {
                                     if(listingdetailschild.item(k).hasChildNodes())
                                      {
                                        if(listingdetailschild.item(k).firstChild.nodeValue!=" ")
                                         { 
                                            html_text +="<td>"+ listingdetailschild.item(k).firstChild.nodeValue+"</td>";
                                         }
                                        else
                                         {
                                            html_text +="<td>&nbsp;</td>";
                                         }
                                      }
                                     else
                                      {
                                        html_text +="<td>&nbsp;</td>";
                                      }
                                   }
                                  if(nodeName=="Notes")
                                   {
                                    if(listingdetailschild.item(k).hasChildNodes())
                                      {
                                         if(listingdetailschild.item(k).firstChild.nodeValue!=" ")
                                         {
                                           html_text +="<td><a href='"+listingdetailschild.item(k).firstChild.nodeValue+"'>Link to lisitng</td>";
                                         }
                                         else
                                         {
			                   html_text +="<td>&nbsp;</td>";
                                         }
                                      }
                                     else
                                      {
                                        html_text +="<td>&nbsp;</td>";
                                      }
                                   }
                                  
                                  if(nodeName=="Logo")
                                   {
            			      if(listingdetailschild.item(k).hasChildNodes())
                                      { 
                                         if(listingdetailschild.item(k).firstChild.nodeValue!=" ")
                                         {                                   
            			           html_text +="<td colspan='3'><img src='"+ listingdetailschild.item(k).firstChild.nodeValue+"' alt='"+listingdetailschild.item(k).firstChild.nodeValue+"'></td>";
                                         }
                                         else
                                         {
					   html_text +="<td colspan='3'>&nbsp;</td>";
                                         }
                                      }
                                     else
                                      {
                                        html_text +="<td colspan='3'>&nbsp;</td>";
                                      }
                                   }
                                  
                                }                               
                             }
                           html_text +="</tr>";
                        }
                   }
               }
            }
        }
      html_text +="</table>";
      html_text +="</html>";
}
     
</script>
</head>
<body>
<br /><br /><br />
<center>
<b>Enter URL for Real Estate xml</b><br /><br />
<form name="sangform" method="POST" id="formid" action="XMLPARSE(URL.value)">
<input type="text" name="URL" id="URL" maxlength="255" size="30" value="">
<br /><br />
<input type= "button" name= "submitquery" id="submit" value= "Submit Query" onClick= "viewxml(this.form)"/>
</form>
</center>
</body>
</html>    